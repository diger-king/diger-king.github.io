---
title: SUWIKI 에서 나는 무엇을 했는가
layout: post
description: SUWIKI 기능 구현 정리
post-image: https://avatars.githubusercontent.com/u/96416159?s=200&v=4

tags:
- Project
- 
---

# 담당 로직 (API 주소는 보안상 삭제)

## User API

- 아이디 중복확인
- 이메일 중복확인
- 회원가입
-  이메일 인증
-  아이디 찾기
-  비밀번호 찾기
-  비밀번호 재설정
-  로그인 (Mobile Environment)
-  로그인 (Web Environment)
-  로그아웃 (Web Environment)
-  토큰 재발급
-  휴면 계정 처리
-  회원탈퇴
-  내 정보
-  이용제한 내역 조회
-  블랙리스트 내역 조회
-  강의평가 신고하기
-  시험정보 신고하기


---

## Admin API

-  관리자 로그인
-  신고된 게시글 리스트 불러오기
-  신고된 게시글 자세히 보기(강의평가)
-  신고된 게시글 자세히 보기(시험정보)
-  강의평가 삭제 및 유저 정지 조치
-  시험정보 삭제 및 유저 정지 조치
-  강의평가 삭제 및 유저 블랙리스트 조치
-  시험정보 삭제 및 유저 블랙리스트 조치
-  신고된 시험정보 이상 없음 조치
-  신고된 강의평가 이상 없음 조치


---

## DB 접근 기술은 Spring Data JPA 및 NativeQuery 를 활용

<br>

### DTO
UserRequsetDto 클래스에, 정적 클래스를 만들어 JSON 타입의 요청 Body를 받도록 하였다.

ex)
    
    class UserRequestDto {
        
        # 예시1) 아이디 중복확인을 위한 DTO

        public static class isOverlapId {
            private String loginId;
        }
    }

위 처럼 각 요청에 대한 DTO 를 만들고, Controller 에서 DTD 를 파라미터로 받는 메서드를 작성하였다.

---

### 아이디 중복 확인
Spring Data JPA 사용 -> findByXXX

---

### 이메일 중복 확인
Spring Data JPA 사용 -> findByXXX

---

### 회원가입
    - 교내 이메일 주소로 재학생 인증 Email 전송
    - 이메일 인증 수행
    - 블랙리스트 유저 판별

<br>

> 이메일 인증은 서버 측에서, 유일하게 식별되는 토큰을 발급하여 입력받은 이메일로 전송한 후
> 
> 이메일 인증링크를 클릭할 시 서버에서 발급한 토큰값에 일치여부와 함께 최종 회원가입을 처리한다.

---
    
### 로그인
    - 아이디 및 비밀번호 매칭 (BcryptEncoder)
    - JWT 발급 혹은 재발급 로직 구현 (Web : Set-Cookie, Mobile : JSON )

---

### 로그아웃 (Web)
    - Cookie Setting 변경

---

### JWT 검증 및 재발급
    - 요청 JWT 를 서명값을 통해 검증하여 옳바른 토큰인지 혹은 유효기간에 맞는 토큰인지 판별
    - 토큰 만료 시 ErrorCode Setting
    - DB 와 비교 시 Payload 가 조작된 값이 아니라면 재발급 수행 
<br>

> JWT를 Bytes 단위로 가져와 secret Key 에 대하여 해석한다.

---

### 비밀번호 찾기
    - 비밀번호 랜덤 문자열로 초기화 (비밀번호 정책에 부합하도록)
    - 이메일로 초기화된 비밀번호 발송

---

### 비밀번호 재설정
    - 기존 비밀번호와 신규 비밀번호를 입력받는다.

<br>

> 기존 비밀번호가 일치하면, 요청한 신규 비밀번호를 암호화하여 DB에 업데이트한다

---

### 휴면 계정 처리
    - 1년 이상 미 접속 시 휴면계정으로 전환
    - 휴면계정 전환 1개월 전 휴면계정 전환 안내 이메일 발송
    - Soft Delete 기법 사용

<br>

> @Scheduled 어노테이션을 활용하여, 휴면계정 대상을 뽑고, 대상들에게 안내 이메일을 발송한다.

---

### 회원탈퇴
    - Soft Delete 적용 30일간 보관 및 
    - 삭제 대기 중인 유저의 로그인, 이메일로 회원가입 불가 처리

---

### 신고하기
    - 신고하기 테이블에 신고된 테이블과 신고한 유저, 
    - 신고받은 유저의 정보를 담는다. 이 때 신고받은 유저의 정보는 토큰에서 가져오는 것으로 했다.
    - 또한 위 정보들을 토대로 회원가입 테이블에 해당 게시글 정보를 저장한다.

---

### 관리자 페이지 - 신고 당한 게시글 모두 불러오기
    - DB에서 신고당한 게시글 불러온다.
    - 허위 신고 를 남발하는 유저를 확인하기 위해 신고한 유저의 아이디도 들어있다.

---

### 관리자 페이지 - 신고된 게시글 이상 없음
    - 신고 테이블에 존재하는 게시글을 관리자가 판별하여, 제재를 가할 이유가 없는 신고 글이라면 신고 테이블에서 삭제

---

### 관리자 페이지 - 사용자 정지
    - 신고 테이블에 존재하는 게시글을 관리자가 판별하여, 정지 정책에 따른 조치
    - 정지 당한 해당 사용자의 신고당한 게시글은 삭제됨
    - 신고한 유저는 포인트 +1

---

### 관리자 페이지 - 사용자 블랙리스트
    - 신고 테이블에 존재하는 게시글을 관리자가 판별하여, 블랙 정책에 따른 조치
    - 또한 신고 누적 횟수가 3회인 유저는 블랙리스트로 처리된다.
    - 블랙리스트 당한 해당 사용자의 모든 게시글은 삭제됨
    - 신고한 유저는 포인트 +1
    - 블랙리스트 유저는 회원탈퇴를 할 수 있지만 회원탈퇴가 진행되어도, 블랙리스트 기간 동안 재가입 불가 처리

---

### 제재 유저 요청 차단
    - 블랙리스트 유저 혹은 JWT 검증에 실패한 유저의 요청 차단