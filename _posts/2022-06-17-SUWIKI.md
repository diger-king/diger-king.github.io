---
title: SUWIKI 에서 나는 무엇을 했는가
layout: post
description: SUWIKI 기능 구현 정리
post-image: https://avatars.githubusercontent.com/u/96416159?s=200&v=4

tags:
- Project
---
  
## DB 접근 기술은 Spring Data JPA 를 활용

### DTO
UserRequsetDto 클래스에, 정적 클래스를 만들어 JSON 타입의 요청 Body를 받도록 하였다.

ex)
    
    class UserRequestDto {
        
        # 예시1) 아이디 중복확인을 위한 DTO

        public static class isOverlapId {
            private String loginId;
        }
    }

위 처럼 각 요청에 대한 DTO 를 만들고, Controller 에서 DTD 를 파라미터로 받는 메서드를 작성하였다.


### 회원가입
    - 아이디 중복 확인
    - 이메일 중복 확인
    - 교내 이메일 주소로 재학생 인증 Email 전송
    - 이메일 인증 수행
    - 블랙리스트 유저 판별

---
    
### 로그인
    - 아이디 및 비밀번호 매칭 (BcryptEncoder)
    - JWT 발급 혹은 재발급 로직 구현

---

### JWT 검증 로직
    - 요청 JWT 를 서명값을 통해 검증하여 옳바른 토큰인지 혹은 유효기간에 맞는 토큰인지 판별

JWT를 Bytes 단위로 가져와 secret Key 에 대하여 해석한다.

---

### 비밀번호 찾기
    - 비밀번호 랜덤 문자열로 초기화 (비밀번호 정책에 부합하도록)
    - 이메일로 초기화된 비밀번호 발송

---

### 비밀번호 재설정
    - 기존 비밀번호와 신규 비밀번호를 입력받는다.

기존 비밀번호가 일치하면, 요청한 신규 비밀번호를 암호화하여 DB에 업데이트한다

---

### 휴면 계정 처리
    - 1년 이상 미 접속 시 휴면계정으로 전환
    - 휴면계정 전환 1개월 전 휴면계정 전환 안내 이메일 발송

@Scheduled 어노테이션을 활용하여, 휴면계정 대상을 뽑고, 대상들에게 안내 이메일을 발송한다.

---

### 회원탈퇴
    - 회원탈퇴 정책에 따라 즉시 삭제가 아닌 일정 기간을 두고, 
    해당 기간을 초과할 시 데이터베이스에서 삭제

---

### 신고하기
    - 신고하기 테이블에 신고된 테이블과 신고한 유저, 
    신고받은 유저의 정보를 담는다. 이 때 신고받은 유저의 정보는 토큰에서 가져오는 것으로 했다.

    또한 위 정보들을 토대로 회원가입 테이블에 해당 게시글 정보를 저장한다.

---

### 관리자 페이지 - 신고 당한 게시글 모두 불러오기
    - DB에서 신고당한 게시글 불러온다.
        허위 신고 를 남발하는 유저를 확인하기 위해 신고한 유저의 아이디도 들어있다.

---

### 관리자 페이지 - 사용자 벤
    - 신고 테이블에 존재하는 게시글을 관리자가 판별하여, 벤 정책에 따른 조치
    - 조치사항은 블랙리스트 조치 혹은 이상 없음 두 가지
    - 벤 당한 해당 사용자의 게시글은 삭제됨

---

### 블랙리스트
    - 벤 당한 사용자는 블랙리스트 테이블로 옮겨진다.
    - 사이트를 이용할 수 없으며 회원탈퇴 후 재 가입 또한 막기 위한 로직 또한 구현했다.

---

### 제재 유저 요청 차단
    - 블랙리스트 유저 혹은 JWT 검증에 실패한 유저의 요청 차단

---

